(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();const m=0,x=1,I=2,L=3,E=4,p=5,N=20;class k{constructor(t,e,s){this.i=t,this.j=e,this.color=s}draw(t,e){t.fillStyle=this.color,t.fillRect(this.j*e,this.i*e,e,e)}copy(t){this.i=t.i,this.j=t.j}read(t,e){let s=this.i,a=this.j;switch(t){case 0:s=this.i-1;break;case 1:a=this.j+1;break;case 2:s=this.i+1;break;case 3:a=this.j-1;break}return e.portalIn&&e.portalOut&&s===e.portalIn.i&&a===e.portalIn.j?{type:"PORTAL",target:e.portalOut}:e.portalIn&&e.portalOut&&s===e.portalOut.i&&a===e.portalOut.j?{type:"PORTAL",target:e.portalIn}:e.read(s,a)}}const n={score:0,mode:null,level:1,fruitsToCollect:3,fruitsCollected:0,levelDuration:15,updateInterval:null,countdownInterval:null,levelTimer:null,gameStarted:!1,gameOver:!1,awaitingNextLevel:!1,canRender:!1,messageDisplay:null,scoreDisplay:null,timerDisplay:null};function B(i,t,e,s,a){i.clearRect(0,0,i.canvas.width,i.canvas.height),t.draw(i,a),e.move(t),s.move(t),e.draw(i,a),s.draw(i,a)}function F(){clearInterval(n.countdownInterval),clearTimeout(n.levelTimer),n.timerDisplay.textContent=""}function J(){const i=document.getElementById("overlay"),t=document.getElementById("overlay-message"),e=document.getElementById("restart-button");i.classList.remove("hidden"),t.classList.remove("hidden"),t.textContent="üíÄ Game Over !",e.textContent="Recommencer"}function _(){F(),clearInterval(n.updateInterval),n.gameOver=!0,n.gameStarted=!1,J()}function G(){let i=n.levelDuration;n.timerDisplay.textContent=`‚è≥ Temps restant : ${i}s`,n.countdownInterval=setInterval(()=>{i--,n.timerDisplay.textContent=`‚è≥ Temps restant : ${i}s`,i<=0&&(clearInterval(n.countdownInterval),_())},1e3)}class T{constructor(t,e,s,a,o=!1){this.anneaux=[],this.direction=a,this.isPlayer=o,this.lastTurnTime=Date.now(),this.lastBotTurn=Date.now();for(let r=0;r<t;r++)this.anneaux.push(new k(e,s,"black"));this.updateColors()}updateColors(){const t=this.anneaux.length;for(let e=0;e<t;e++){const s=e/(t-1);if(this.isPlayer){const a=Math.floor(0+153*s),o=Math.floor(100+155*s),r=Math.floor(0+153*s);this.anneaux[e].color=`rgb(${a},${o},${r})`}else{const a=Math.floor(102+119*s);this.anneaux[e].color=`rgb(${a},${a},${a})`}}}draw(t,e){this.anneaux.forEach(s=>s.draw(t,e))}move(t){const e=this.anneaux[0];let s=e.read(this.direction,t);if(!this.isPlayer){const a=Date.now();if([x,I,L,E].includes(s)||a-this.lastBotTurn>1e3){const r=[0,1,2,3];let h=!1;for(;r.length>0&&!h;){const Y=Math.floor(Math.random()*r.length),P=r.splice(Y,1)[0],j=e.read(P,t);j===m&&(this.direction=P,s=j,this.lastBotTurn=a,h=!0)}if(!h)return}}if(typeof s=="object"&&s.type==="PORTAL"){const a=this.anneaux[this.anneaux.length-1];t.write(a.i,a.j,m);for(let o=this.anneaux.length-1;o>0;o--)this.anneaux[o].copy(this.anneaux[o-1]);e.i=s.target.i,e.j=s.target.j,this.writeBodyToTerrain(t),this.updateColors();return}if(s===m||s===L&&this.isPlayer){const a=this.anneaux[this.anneaux.length-1];t.write(a.i,a.j,m);for(let o=this.anneaux.length-1;o>0;o--)this.anneaux[o].copy(this.anneaux[o-1]);switch(this.direction){case 0:e.i--;break;case 1:e.j++;break;case 2:e.i++;break;case 3:e.j--;break}if(this.writeBodyToTerrain(t),s===L&&this.isPlayer){const o=this.anneaux[this.anneaux.length-1],r=new k(o.i,o.j,"yellow");this.anneaux.push(r),n.score++,n.scoreDisplay.textContent=`Score : ${n.score}`,t.generateFood(),n.mode==="aventure"&&(n.fruitsCollected++,n.fruitsCollected>=n.fruitsToCollect&&(F(),clearInterval(n.updateInterval),n.level++,n.fruitsCollected=0,n.fruitsToCollect++,n.levelDuration+=3,n.awaitingNextLevel=!0,n.messageDisplay.textContent=`‚úÖ Niveau ${n.level-1} r√©ussi ! Appuyez sur une fl√®che pour continuer...`,n.gameStarted=!1))}this.updateColors();return}[x,I,E].includes(s)&&(this.isPlayer?_():this.direction=Math.floor(Math.random()*4))}writeBodyToTerrain(t){for(let e=0;e<this.anneaux.length;e++){const s=this.isPlayer?I:E;t.write(this.anneaux[e].i,this.anneaux[e].j,s)}}extend(){const t=this.anneaux[this.anneaux.length-1],e=new k(t.i,t.j,"yellow");this.anneaux.push(e),this.updateColors()}}function w(i){return Math.floor(Math.random()*i)}class K{constructor(t,e){this.largeur=t,this.hauteur=e,this.sol=new Array(t);for(let s=0;s<t;s++)this.sol[s]=new Array(e).fill(m);this.activeRock=null,this.portalIn=null,this.portalOut=null,this.generateRocks(),this.generatePortals()}generateRocks(){this.rockIntervalId&&clearInterval(this.rockIntervalId),this.rockIntervalId=setInterval(()=>{if(this.activeRock){const{x:s,y:a}=this.activeRock;this.sol[s][a]===1&&(this.sol[s][a]=0)}let t,e;do t=Math.floor(Math.random()*(this.largeur-2))+1,e=Math.floor(Math.random()*(this.hauteur-2))+1;while([2,4,5].includes(this.sol[t][e]));this.sol[t][e]=1,this.activeRock={x:t,y:e}},3e3)}generatePortals(){const e=()=>{let s,a;do s=w(this.hauteur-4)+2,a=w(this.largeur-4)+2;while(this.sol[a][s]!==m);return{i:a,j:s}};this.portalIn=e(),this.portalOut=e(),this.sol[this.portalIn.i][this.portalIn.j]=p,this.sol[this.portalOut.i][this.portalOut.j]=p}generateFood(){let t,e;do t=w(this.largeur-2)+1,e=w(this.hauteur-2)+1;while([I,E,x,p].includes(this.sol[t][e]));this.sol[t][e]=L}draw(t,e){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.font=`${e*.8}px Arial`,t.textAlign="center",t.textBaseline="middle";for(let s=0;s<this.largeur;s++)for(let a=0;a<this.hauteur;a++){const o=this.sol[s][a],r=a*e+e/2,h=s*e+e/2;if(this.portalIn&&s===this.portalIn.i&&a===this.portalIn.j||this.portalOut&&s===this.portalOut.i&&a===this.portalOut.j){t.fillText("üåÄ",r,h);continue}switch(o){case 1:t.fillText("üöß",r,h);break;case 3:t.fillText("üçä",r,h);break}}t.strokeStyle="gray";for(let s=0;s<=this.largeur;s++)t.beginPath(),t.moveTo(s*e,0),t.lineTo(s*e,this.hauteur*e),t.stroke();for(let s=0;s<=this.hauteur;s++)t.beginPath(),t.moveTo(0,s*e),t.lineTo(this.largeur*e,s*e),t.stroke()}read(t,e){return t<0||t>=this.largeur||e<0||e>=this.hauteur?x:this.sol[t][e]}write(t,e,s){if(t>=0&&t<this.largeur&&e>=0&&e<this.hauteur){if(this.sol[t][e]===p&&s===m)return;this.sol[t][e]=s}}}n.messageDisplay=document.getElementById("message");n.timerDisplay=document.getElementById("timer");n.scoreDisplay=document.getElementById("score");const $=document.getElementById("intro-music"),b=document.getElementById("music-toggle");let D=!1;const d=document.getElementById("terrain"),O=d.getContext("2d");let u=N,f,g;const U=window.innerWidth<=767;U?(f=15,g=15):(f=20,g=20);d.width=f*u;d.height=g*u;const S=document.getElementById("start-button"),A=document.getElementById("overlay"),V=document.getElementById("restart-button"),X=document.getElementById("exit-button"),C=document.getElementById("fullscreen"),M=document.getElementById("intro-screen"),R=document.getElementById("game-wrapper"),y=document.getElementById("info-panel");let c,v,l;function H(){c=new T(5,5,5,1,!0),v=new T(7,10,10,2,!1),l=new K(f,g),l.generateFood()}document.getElementById("btn-survivant").addEventListener("click",()=>{n.mode="survivant",M.classList.add("hidden"),R.classList.remove("hidden"),C.classList.remove("hidden"),y.classList.add("hidden")});document.getElementById("btn-aventure").addEventListener("click",()=>{n.mode="aventure",M.classList.add("hidden"),R.classList.remove("hidden"),C.classList.remove("hidden"),y.classList.add("hidden")});function q(){const i=document.getElementById("mobile-controls");window.innerWidth<=767&&i.classList.remove("hidden")}S.addEventListener("click",()=>{S.classList.add("hidden"),document.getElementById("start-panel").classList.add("hidden"),A.classList.add("hidden"),q(),z()});X.addEventListener("click",()=>{A.classList.add("hidden"),document.getElementById("overlay-message").classList.add("hidden"),R.classList.add("hidden"),M.classList.remove("hidden"),document.getElementById("mobile-controls").classList.add("hidden"),document.getElementById("start-panel").classList.remove("hidden"),S.classList.remove("hidden"),n.mode=null,n.level=1,n.fruitsCollected=0,n.fruitsToCollect=3,n.levelDuration=15,n.score=0,n.gameOver=!1,n.gameStarted=!1,n.canRender=!1,n.scoreDisplay.textContent="Score : 0",n.messageDisplay.textContent="",n.timerDisplay.textContent="",y.classList.add("hidden"),C.classList.add("hidden")});V.addEventListener("click",()=>{n.gameOver&&(q(),z())});function z(){A.classList.add("hidden"),document.getElementById("overlay-message").classList.add("hidden"),clearInterval(n.updateInterval),H(),n.score=0,n.fruitsCollected=0,n.level=1,n.fruitsToCollect=3,n.levelDuration=15,n.gameOver=!1,n.gameStarted=!0,n.awaitingNextLevel=!1,n.canRender=!0,n.scoreDisplay.textContent="Score : 0",n.timerDisplay.textContent="",n.messageDisplay.textContent="",n.updateInterval=setInterval(()=>{B(O,l,c,v,u)},130),n.mode==="aventure"?(y.classList.remove("hidden"),n.messageDisplay.textContent=`üåü Niveau ${n.level} : Collectez ${n.fruitsToCollect} fruits`,G()):y.classList.add("hidden")}function W(){clearInterval(n.updateInterval),l.sol.forEach(i=>i.fill(0)),l.activeRock=null,l.portalIn=null,l.portalOut=null,l.generateRocks(),l.generatePortals(),l.generateFood(),c=new T(5,5,5,1,!0),c.extend(),c.extend(),c.extend(),c.extend(),v=new T(7,10,10,2,!1),n.fruitsCollected=0,n.fruitsToCollect++,n.levelDuration+=3,n.gameStarted=!0,n.awaitingNextLevel=!1,n.canRender=!0,n.messageDisplay.textContent=`üåü Niveau ${n.level} : Collectez ${n.fruitsToCollect} fruits`,n.updateInterval=setInterval(()=>{B(O,l,c,v,u)},130),G()}window.addEventListener("keydown",i=>{const e={ArrowUp:0,ArrowRight:1,ArrowDown:2,ArrowLeft:3}[i.key];e!==void 0&&n.gameStarted&&!n.gameOver&&(c.direction=e),e!==void 0&&!n.gameStarted&&!n.gameOver&&n.mode==="aventure"&&W()});document.querySelectorAll(".arrow-btn").forEach(i=>{i.addEventListener("click",()=>{const t=parseInt(i.dataset.dir);n.gameStarted&&!n.gameOver&&(c.direction=t),!n.gameStarted&&!n.gameOver&&n.mode==="aventure"&&W()})});C.addEventListener("click",()=>{const i=document.getElementById("game-layout");i.requestFullscreen&&i.requestFullscreen(),setTimeout(()=>{const t=Math.floor(screen.width/f),e=Math.floor(screen.height/g);u=Math.min(t,e),d.width=f*u,d.height=g*u,d.style.width=d.width+"px",d.style.height=d.height+"px",n.canRender&&B(O,l,c,v,u)},300)});document.addEventListener("fullscreenchange",()=>{!!document.fullscreenElement?document.body.classList.add("fullscreen"):(document.body.classList.remove("fullscreen"),u=N,d.width=f*u,d.height=g*u,d.style.width="",d.style.height="",n.canRender&&B(O,l,c,v,u))});b.addEventListener("click",()=>{D?($.pause(),b.textContent="üîá"):($.play().catch(()=>{}),b.textContent="üîä"),D=!D});
